<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lensspace.com</title>
  <link rel="shortcut icon" type="image/png" href="/admin/assets/images/logos/favicon.png" />
  <link rel="stylesheet" href="/admin/assets/css/styles.min.css" />
</head>

<body>
  <!--  Body Wrapper -->
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed">
    <%-include('./includes/sidebar.ejs')%>
    <!--  Main wrapper -->
    <div class="body-wrapper">
      <!--  Header Start -->
      <%-include("./includes/header.ejs")%>
      <!--  Header End -->

<!-- <main class="main-wrap"> -->
  <section class="content-main">
    <div class="content-header">
        <h2 class="content-title">Users list</h2>
        
    </div>
    <div class="card mb-4">
        <div class="card-body">
        
                <form action="/admin/addProduct" method="post" enctype="multipart/form-data" id="myForm">
                    <section class="content-main">
                    
                        <div class="row">
                            <div class="col-6">
                                <div class="content-header">
                                    <h2 class="content-title">Add New Product</h2>
                                    
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <div class="row">
                                            <!-- <div class="col-md-3">
                                                <h6>1. General info</h6>
                                            </div> -->
                                            <div class="col-md-9">
                                                <div class="mb-4">
                                                    <label class="form-label">Product title</label>
                                                    <input type="text" placeholder="Type here" class="form-control" name="name" id="name" onkeyup="nameValidation()">
                                                    <span id="nameError"></span>
                                                </div>
                                                <div class="mb-4">
                                                    <label class="form-label">Description</label>
                                                    <textarea placeholder="Type here" class="form-control" rows="4" name="description" id="description" onkeyup="descriptionValidation()"></textarea>
                                                    <span id="descriptionError"></span>
                                                </div>
                                                <div class="mb-4">
                                                    <label class="form-label">Category</label>
                                                    
                                                    <select class="form-select" name="category">
                                                        <% category.forEach(function(category) { %>
                                                        <option value="<%= category._id %>"><%= category.name %>
                                                        </option>
                                                        <% }); %>
                                                    </select>
                                                </div>
                                            </div> <!-- col.// -->
                                        </div> <!-- row.// -->
                                        <hr class="mb-4 mt-0">
                                        <div class="row">
                                            <!-- <div class="col-md-3">
                                                <h6>2. Pricing</h6>
                                            </div> -->
                                            <div class="col-md-9">
                                                <div class="mb-4">
                                                    <label class="form-label">Cost in INR</label>
                                                    <input type="number" placeholder="00.0" class="form-control" name="price" id="price" onkeyup="priceValidation()">
                                                    <span id="priceError"></span>
                                                </div>
                                                <div class="mb-4">
                                                  <label class="form-label">Stock</label>  
                                                  <input type="number" placeholder="0" class="form-control" name="stock" id="stock" onkeyup="stockValidation()">
                                                  <span id="stockError"></span>
                                              </div>
                                            </div> <!-- col.// -->
                                        </div> <!-- row.// -->
                                        
                                        <hr class="mb-4 mt-0">
                                       
            
                                        <div class="col-lg-6">
                                            <div class="card mb-4">
                                              <div class="card-header">
                                                <h4>Add Images</h4>
                                              </div>
                                              <div class="imgPreviewContainer" id="imgPreviewContainer"></div>

                                              <div>
                                                <input type="file" id="images" name="images" class="form-control" onchange="viewImages(event)" multiple>
                                            </div>
                                             
                                            </div> <!-- card end// -->
                                            
                                          </div>
                                          
                                          
                                            
                                    
                                       
                                        
                                        <!-- .row end// -->
                                    </div>
                                    <p><%=(typeof message!=='undefined')?message:""%></p>
                                    <div>
                                        <input class="btn btn-primary" value="Publish" type="submit"></input>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        
                        </div>
                       
                    </form>
                
                

        
         <!-- .col// -->
        </div>

            
        </div> <!-- card-body end// -->
    </div> <!-- card end// -->
   

 </section> 

</main>

  <script>
const myForm = document.getElementById("myForm")
const name = document.getElementById("name")
const description = document.getElementById("description")
const price = document.getElementById("price")
const stock = document.getElementById("stock")
const nameError = document.getElementById("nameError")
const descriptionError = document.getElementById("descriptionError")
const priceError = document.getElementById("priceError")
const stockError = document.getElementById("stockError")


function nameValidation(){
      const nameValue = name.value
			if(nameValue.trim()==0){
				nameError.innerHTML = 'Product title is required'
				nameError.style.color = 'red'
				name.style.border = "solid 2px red";
				return false;
			}
      nameError.innerHTML = ""
			nameError.style.color = "green"
			name.style.border = "solid 2px green";
			return true
        
      }


function descriptionValidation(){
      const descriptionValue = description.value
			if(descriptionValue.trim()==0){
				descriptionError.innerHTML = 'Descripion is required'
				descriptionError.style.color = 'red'
				description.style.border = "solid 2px red";
				return false;
			}
      descriptionError.innerHTML = ""
			descriptionError.style.color = "green"
			description.style.border = "solid 2px green";
			return true
        
      }



function priceValidation(){
      const priceValue = price.value
			if(priceValue.trim()==0){
				priceError.innerHTML = 'Price is Required'
				priceError.style.color = 'red'
				price.style.border = "solid 2px red";
				return false;
			}
      if(priceValue <= 0 ){
				priceError.innerHTML = 'Price Must be greater than zero'
				priceError.style.color = 'red'
				price.style.border = "solid 2px red";
				return false;
			}
      priceError.innerHTML = ""
			priceError.style.color = "green"
			price.style.border = "solid 2px green";
			return true
        
      }


function stockValidation(){
      const stockValue = stock.value
			if(stockValue.trim()==0){
				stockError.innerHTML = 'Stock is Required'
				stockError.style.color = 'red'
				stock.style.border = "solid 2px red";
				return false;
			}
      if(stockValue <  0 ){
				stockError.innerHTML = 'Stock Must be greater than or equal to zero'
				stockError.style.color = 'red'
				stock.style.border = "solid 2px red";
				return false;
			}
      stockError.innerHTML = ""
			stockError.style.color = "green"
			stock.style.border = "solid 2px green";
			return true
        
      }

function viewImages(event) {
        const files = event.target.files;
        const imgPreviewContainer = document.getElementById("imgPreviewContainer");
        
        // Clear the preview container
        imgPreviewContainer.innerHTML = '';

        if (files.length > 3) {
            alert('You can upload up to 3 images only.'); 
            event.target.value = '';  // Clear the input 
            return;
        }

        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            
            // Validate file size
            if (file.size > 2 * 1024 * 1024) {
                alert('Each image should be less than 2MB in size.');
                event.target.value = '';  // Clear the input
                return;
            }

            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png'];
            if (!validTypes.includes(file.type)) {
                alert('Only jpeg and png image types are allowed.');
                event.target.value = '';  // Clear the input
                return;
            }

            // Display image preview
            const imgPreview = document.createElement('img');
            imgPreview.src = URL.createObjectURL(file);
            imgPreview.width = 100;
            imgPreview.height = 100;
            imgPreviewContainer.appendChild(imgPreview);
        }
    }

      
      myForm.addEventListener("submit",(event)=>{
			event.preventDefault();
			if(!nameValidation() || !descriptionValidation() || ! priceValidation()) {
				return false
			}else{
				myForm.submit()
			}

		})


 </script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  






<script src="/admin/assets/libs/jquery/dist/jquery.min.js"></script>
<script src="/admin/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

<script src="/admin/assets/js/app.min.js"></script>
<script src="/admin/assets/libs/apexcharts/dist/apexcharts.min.js"></script>
<script src="/admin/assets/libs/simplebar/dist/simplebar.js"></script>




<script src="../admin-assets/js/vendors/jquery-3.6.0.min.js"></script>
<script src="../admin-assets/js/vendors/bootstrap.bundle.min.js"></script>
<script src="../admin-assets/js/vendors/select2.min.js"></script>
<script src="../admin-assets/js/vendors/perfect-scrollbar.js"></script>
<script src="../admin-assets/js/vendors/jquery.fullscreen.min.js"></script>
<!-- Main Script -->
<script src="../admin-assets/js/main.js" type="text/javascript"></script>
<script>
    function viewImage1(event) {
document.getElementById('imgView1').src = URL.createObjectURL(event.target.files[0])
}

function viewImage2(event) {
document.getElementById('imgView2').src = URL.createObjectURL(event.target.files[0])
}

function viewImage3(event) {
document.getElementById('imgView3').src = URL.createObjectURL(event.target.files[0])
}
</script>
<script>
function viewImage(event, index) {
    let input = event.target;
    let reader = new FileReader();

    reader.onload = function() {
      let dataURL = reader.result;
      let image = document.getElementById('imgView' + index);
      image.src = dataURL;

      // Initialize Cropper.js on the image
      // let cropper = new Cropper(image, {
      //   aspectRatio: 1 / 1, // Set the aspect ratio to 1:1 for square images
      //   viewMode: 1, // Set the view mode to crop box
      //   guides: true, // Show the crop guides
      //   background: false, // Do not show the background behind the image
      //   autoCropArea: 1, // Set the initial crop area to cover the whole image
      //   zoomable: true // Disable zooming to keep the image size fixed
      // });

      // Show the image cropper container
      // let cropperContainer = document.querySelector('#croppedImg' + index).parentNode;
      // cropperContainer.style.display = 'block';

      // // Update the cropped image when the "Save" button is clicked
      // let saveButton = document.querySelector('#saveButton' + index);
      // saveButton.addEventListener('click', async function() {
      //   let croppedCanvas = cropper.getCroppedCanvas({
      //     width: 1500, 
      //     height: 1500 
      //   });
      //   let croppedImage = document.getElementById("croppedImg" + index);
      //   croppedImage.src = croppedCanvas.toDataURL('image/jpeg', 1.0);

      //   // Generate a unique name for the cropped image file based on the current timestamp
      //   let timestamp = new Date().getTime();
      //   let fileName = `cropped-img-${timestamp}-${index}.png`;

      //   await croppedCanvas.toBlob(blob => {
      //     let input = document.getElementById('input' + index)
      //     let imgFile = new File([blob], fileName, blob)
      //     const fileList = new DataTransfer();
      //     fileList.items.add(imgFile);
      //     input.files = fileList.files
      //   });
        // cropperContainer.style.display = 'none';
      // });

    };

    reader.readAsDataURL(input.files[0]);
  }
</script>

</body>

</html>